; /usr/local/etc/php-fpm.d/www.conf

[www]

; Listen on TCP so nginx in a separate container can reach FPM
listen = 0.0.0.0:9000

; Optional: increase backlog if you see connection queueing
listen.backlog = 1024

; Pass environment vars through (Docker images usually set this already)
clear_env = no

; Log worker stderr/stdout to FPM logs (useful in containers)
catch_workers_output = yes

; --- Process Manager ---
; Use "dynamic" for snappy response under load, or "ondemand" to save RAM when idle
pm = dynamic
pm.max_children = 10          ; tune to CPU/RAM (rule of thumb: 2â€“4 per CPU core)
pm.start_servers = 2
pm.min_spare_servers = 2
pm.max_spare_servers = 5
pm.max_requests = 500         ; recycle workers to avoid memory leaks

; Kill overly long requests (keep >= nginx fastcgi_read_timeout)
request_terminate_timeout = 120s

; --- Slowlog (find bottlenecks) ---
slowlog = /tmp/php-fpm.slow.log
request_slowlog_timeout = 5s

; --- Status & Ping (for health checks) ---
pm.status_path = /fpm-status
ping.path = /fpm-ping
