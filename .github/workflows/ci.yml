name: CI

on:
  push:
    branches: [ '*', 'feature/*' ]
    tags: [ '*' ]
  pull_request:
    branches: [ '*' ]

jobs:
  ci:
      name: Run Quality Checks
      runs-on: ubuntu-latest

      steps:
        - name: Checkout Repository
          uses: actions/checkout@v4

        - name: Set up PHP
          uses: shivammathur/setup-php@v2
          with:
            php-version: '8.4'
            tools: composer, phpunit, xdebug
            coverage: xdebug

        - name: Install Dependencies
          run: composer install --no-progress --no-suggest --prefer-dist

        - name: Run PHPUnit Tests
          run: vendor/bin/phpunit --configuration phpunit.xml --coverage-clover=coverage/clover.xml --path-coverage

        - uses: qltysh/qlty-action/coverage@v1
          with:
            token: ${{ secrets.QLTY_COVERAGE_TOKEN }}
            files: coverage/clover.xml
